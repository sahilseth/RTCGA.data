{
    "contents" : "---\ntitle: \"Using `RTCGA` package to download clinical data that are included in `RTCGA.data`\"\nauthor: \"Marcin KosiÅ„ski\"\ndate: \"`r Sys.Date()`\"\noutput: \n   html_document:\n      fig_width: 17\n      fig_height: 10\n      toc: true\n      toc_depth: 3\n      theme: readable\n      highlight: pygments\n      keep_md: true\n      includes:\n         in_header: include/in_header.html\n         before_body: include/before_body.html\n---\n\n```{r, echo=FALSE}\nlibrary(knitr)\nopts_chunk$set(comment=\"\", message=FALSE, warning = FALSE, tidy.opts=list(keep.blank.line=TRUE, width.cutoff=150),options(width=150), cache=TRUE, eval = FALSE)\n```\n\n# RTCGA package\n\n> The Cancer Genome Atlas (TCGA) Data Portal provides a platform for researchers to search, download, and analyze data sets generated by TCGA. It contains clinical information, genomic characterization data, and high level sequence analysis of the tumor genomes[1]. The key is to understand genomics to improve cancer care.\n\n`RTCGA` package offers download and integration of the variety and volume of TCGA data using patient barcode key, what enables easier data possession. This may have an benefcial infuence on impact on development of science and improvement of patients' treatment. `RTCGA` is an open-source R package, available to download from Bioconductor (not there yet) or from github\n```{r}\nif (!require(devtools)) {\n    install.packages(\"devtools\")\n    require(devtools)\n}\ninstall_github(\"MarcinKosinski/RTCGA\")\n```\n\nFurthermore, `RTCGA` package transforms TCGA data to form which is convenient to use in R statistical package. Those data transformations can be a part of statistical analysis pipeline which can be more reproducible with `RTCGA`.\n\n# How to download clinical data to gain the sama datasets as in RTCGA.package?\n\nThere are many available date times of TCGA data releases. To see them all just type:\n```{r}\nlibrary(RTCGA)\navailableDates()\n```\n\nVersion 0.1 of `RTCGA.data` package contains clinical datasets from `2015-04-02`.\nThere were downloaded as follows (which is mainly copied from [http://marcinkosinski.github.io/RTCGA/](http://marcinkosinski.github.io/RTCGA/):\n\n## Available cohorts\n\nAll cohort names can be checked using:\n```{r}\n(cohorts <- infoTCGA() %>% \n   names() %>% \n   sub(\"-counts\", \"\", x=.))\n```\n\nFor all cohorts the following code downloads the clinical data.\n\n## Downloading tarred files\n```{r}\n#dir.create( \"data2\" )\ndate <- \"2015-04-02\"\ndownloadTCGA( cancerTypes = cohorts, destDir = \"data2/\", date = date )\n```\n\n## Untarring downloaded files\n\n```{r}\nlist.files( \"data2/\") %>% \n   paste0( \"data2/\", .) %>%\n   sapply( untar, exdir = \"data2/\" )\n```\n## Removing no longer needed tar.gz files\nAfter datasets are untarred, the `tar.gz` files ar no longer needed and can be deleted.\n\n```{r}\nlist.files( \"data2/\") %>% \n   paste0( \"data2/\", .) %>%\n   grep( pattern = \"tar.gz\", x = ., value = TRUE) %>%\n   sapply( file.remove )\n\n```\n\n## Reading downloaded clinical dataset\n\n### Paths to clinical data\nBelow is the code that automatically gives the path to `*.clinical.merged.txt` files for all cohorts types downloaded to `data2` folder.\n\n```{r}\nsapply( cohorts, function( element ){\n   folder <- grep( paste0( \"(_\",element,\"\\\\.\", \"|\",\"_\",element,\"-FFPE)\", \".*Clinical\"), list.files(\"data2/\"),value = TRUE)\n   path <- paste0( \"data2/\", folder, \"/\", element, \".clin.merged.txt\")\n   assign( value = path, x = paste0(element, \".clin.path\"), envir = .GlobalEnv)\n}) \n```\n\n### Reading clinical data using `read.clinical`\n\nBecause of that clinical data are transposed in downloaded files, there have been prepared special function `read.clinical` to read and transpose data automatically. Code is below\n\n\n```{r}\nsapply( cohorts, function(element){\n   tryCatch({\n    assign( value = read.clinical(get(paste0(element,\".clin.path\"),\n                                      envir = .GlobalEnv)),\n            x = paste0(element, \".clinical\"),\n            envir = .GlobalEnv )\n    },\n   error=function(cond){\n   cat(\"Error: Maybe there weren't clinical data for \", element, \" cancer.\\n\")\n})\n})\n```\n\n\nI'm not proud of the code that is inside that function. If anyone could rewrite this function using `fread` from `data.tables` package I would be glad to recieve a pull request here: [https://github.com/MarcinKosinski/RTCGA](https://github.com/MarcinKosinski/RTCGA)\n\nBy now it looks like this\n```{r}\nread.clinical <- function(clinicalDir, ...){\n    assert_that(is.character(clinicalDir) & length(clinicalDir) == 1)\n    comboClinical <- read.delim(clinicalDir)\n    colNames <- comboClinical[, 1]\n    comboClinical <- as.data.frame(t(comboClinical[, -1]), ...)\n    names(comboClinical) <- colNames\n    comboClinical <- as.data.table(comboClinical)\n    comboClinical <- comboClinical[, unique(names(comboClinical)), with = FALSE]\n    comboClinical <- as.data.frame(comboClinical, ...)\n    return(comboClinical)\n}\n```\n\n\n# Saving clinical data to `RTCGA.data` package\n\n\n```{r}\ngrep( \"clinical\", ls(), value = TRUE) %>%\n   cat( sep=\",\" ) #can one to id better? as from use_data documentation:\n   # ...\tUnquoted names of existing objects to save\n   devtools::use_data(ACC.clinical,BLCA.clinical,BRCA.clinical,CESC.clinical,CHOL.clinical,COAD.clinical,COADREAD.clinical,\n                      DLBC.clinical,ESCA.clinical,FPPP.clinical,GBM.clinical,GBMLGG.clinical,HNSC.clinical,KICH.clinical,\n                      KIPAN.clinical,KIRC.clinical,KIRP.clinical,LAML.clinical,LGG.clinical,LIHC.clinical,LUAD.clinical,\n                      LUSC.clinical,MESO.clinical,OV.clinical,PAAD.clinical,PCPG.clinical,READ.clinical,SKCM.clinical,\n                      STAD.clinical,STES.clinical,TGCT.clinical,THCA.clinical,THYM.clinical,UCEC.clinical,UCS.clinical,\n                      UVM.clinical)\n```\n\n",
    "created" : 1433274651076.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2886623340",
    "id" : "7E05C848",
    "lastKnownWriteTime" : 1433274655,
    "path" : "C:/Users/Marcin/Desktop/RTCGA.data/ghPage/downloading_clinical_datasets.Rmd",
    "project_path" : "ghPage/downloading_clinical_datasets.Rmd",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_markdown"
}